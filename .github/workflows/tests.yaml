name: Tests

on: [ push, pull_request ]

# Tests ensures the project builds and executes unittest.
# The entry points are rather minimal.
jobs:
  ddhx:
    strategy:
      matrix:
        # https://docs.github.com/en/actions/how-tos/write-workflows/choose-where-workflows-run/choose-the-runner-for-a-job#standard-github-hosted-runners-for-public-repositories
        os: [
          ubuntu-22.04, ubuntu-24.04,
          windows-2022, windows-2025,
          windows-11-arm,
          macos-13, macos-14, macos-15
        ]
        # https://github.com/dlang-community/setup-dlang
        dc: [ dmd, gdc, ldc ]
        exclude:
          # DMD is x86 only
          - { os: windows-11-arm, dc: dmd }
          - { os: macos-14, dc: dmd }
          - { os: macos-15, dc: dmd }
          # GDC is Linux only
          - { os: windows-2022, dc: gdc }
          - { os: windows-2025, dc: gdc }
          - { os: windows-11-arm, dc: gdc }
          - { os: macos-13, dc: gdc }
          - { os: macos-14, dc: gdc }
          - { os: macos-15, dc: gdc }
    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v4
    - name: Setup D compiler
      uses: dlang-community/setup-dlang@v2
      with:
        compiler: ${{ matrix.dc }}
    # Ensure it compiles (with main) and runs
    - name: Compile & run
      run: dub -- --ver
    # Ensure basic functionality
    - name: Unit tests
      run: dub test